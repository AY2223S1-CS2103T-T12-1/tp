@startuml
!include style.puml

box Logic LOGIC_COLOR_T1
participant ":GradeCommand" as GradeCommand LOGIC_COLOR
participant "<<class>>\nIndexUtil" as Util LOGIC_COLOR
participant ":CommandResult" as CommandResult LOGIC_COLOR
participant "oldStudent:Student" as OldStudent LOGIC_COLOR
end box

box Model MODEL_COLOR_T1
participant ":Model" as Model MODEL_COLOR
end box

[-> GradeCommand: execute(model)
activate GradeCommand

GradeCommand -> Model: getFocusedClass()
activate Model
Model --> GradeCommand: focusedClass
deactivate Model

GradeCommand -> Model: getFilteredStudentList()
activate Model
Model --> GradeCommand: lastShownList
deactivate Model

GradeCommand -> Util: getAtIndices
activate Util
Util --> GradeCommand: studentsToGrade
deactivate Util

loop for each oldStudent in studentsToGrade
    GradeCommand -> OldStudent: updateGrade(focusedClass, session, grade)
    activate OldStudent

    ref over OldStudent #fffff
        construct new student
        with updated grade
    end ref

    OldStudent --> GradeCommand: newStudent
    deactivate OldStudent

    GradeCommand -> Model: setStudent(oldStudent, newStudent)
    activate Model
    Model --> GradeCommand
    deactivate Model
end

create CommandResult
GradeCommand -> CommandResult
activate CommandResult

CommandResult --> GradeCommand
deactivate CommandResult

GradeCommand -->[: result

@enduml
